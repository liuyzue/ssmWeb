<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.founder.dao.ErrorInfoDao">
    <select id="selectAll" resultType="com.founder.entity.ErrorInfo">
        select id, sql_text, table_name, result_type, upload_date, check_date, person_id, ehr_id
        from ERROR_INFO
    </select>

    <select id="selectByPersonId" parameterType="Integer" resultType="com.founder.entity.ErrorInfo">
        select id, sql_text, table_name, result_type, upload_date, check_date, person_id, ehr_id
          from ERROR_INFO
          where PERSON_ID=#{person_id}
    </select>

    <select id="selectByUploadTime" resultType="com.founder.entity.ErrorInfo" parameterType="String">
        select id, sql_text, table_name, result_type, upload_date, check_date, person_id, ehr_id
          from ERROR_INFO
          where GATHER_DATE &gt;= to_date(#{startTime},'yyyy/MM/dd hh24:mi:ss') AND GATHER_DATE&lt;= to_date(#{endTime},'yyyy/MM/dd hh24:mi:ss')
    </select>

    <select id="selectByEhrId" parameterType="String" resultType="com.founder.entity.ErrorInfo">
        select id, sql_text, table_name, result_type, upload_date, check_date, person_id, ehr_id
          from ERROR_INFO
          where EHR_ID=#{ehr_id}
    </select>

    <insert id="addErrorInfo" parameterType="java.util.List" >
        insert into ERROR_INFO (SQL_TEXT, table_name, RESULT_TYPE, UPLOAD_DATE, CHECK_DATE, PERSON_ID, EHR_ID)
        select * from (
            <foreach collection="errorInfoList" item="errorInfo" separator="UNION ALL">
                select
                #{errorInfo.sqlText},#{errorInfo.tableName},#{errorInfo.resultType},
                #{errorInfo.uploadDate},#{errorInfo.checkDate},#{errorInfo.personId},
                #{errorInfo.ehrId}
                from dual
            </foreach>
        )
    </insert>

    <delete id="deleteErrorInfoByCheckTime" parameterType="String">
        delete from ERROR_INFO where CHECK_DATE &lt;= to_date(#{checkTime},'yyyy/MM/dd hh24:mi:ss')
    </delete>

    <update id="truncateErrorInfo">
        truncate table error_info
    </update>


</mapper>